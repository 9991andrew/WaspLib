(*
MouseZoom
=========
Methods to handle the zoom levels with he mouse wheel.
*)

{$DEFINE WL_MOUSEZOOM_INCLUDED}
{$IFNDEF WL_OSR}
  {$I WaspLib/osr.simba}
{$ENDIF}

type
  TRSZoomStep = record
    Level: Int32;
    Up: Int32;
    Down: Int32;
  end;

  TRSZoomStepArray = array of TRSZoomStep;

  //TRSZoomToSlider
  TRSZ2S = record
    TrueZoom: Int32;
    Slider: Int32;
  end;

  TRSZ2SArray = array of TRSZ2S;

  TRSMouseZoom = record(TSRLBaseRecord)
    TrueZoomLevel: Int32;
  class const
    TRUE_ZOOM_LEVELS: TRSZoomStepArray = [[0,12,0], [1,13,0], [2,14,0], [4,16,0], [5,18,0], [6,19,0], [7,19,0], [8,20,0], [9,21,0], [10,22,0], [11,24,0], [12,25,0], [13,26,0], [14,27,1], [15,28,1], [16,29,2], [18,31,4], [19,32,5], [20,33,6], [21,34,7], [22,36,8], [23,37,9], [24,37,10], [25,38,11], [26,40,12], [27,41,13], [28,42,14], [29,43,14], [30,44,15], [31,45,16], [32,46,18], [33,47,18], [34,48,19], [35,49,20], [36,50,21], [37,51,22], [38,53,23], [40,55,25], [41,56,26], [42,57,27], [43,58,27], [44,59,29], [45,60,29], [46,61,30], [47,62,31], [48,63,32], [49,64,33], [50,66,34], [51,66,35], [53,68,37], [55,70,38], [56,72,40], [57,73,41], [58,74,41], [59,75,43], [60,76,43], [61,77,45], [62,78,45], [63,79,46], [64,80,47], [65,82,48], [66,82,49], [67,84,50], [68,84,51], [70,87,53], [72,89,55], [73,90,56], [74,91,56], [75,92,58], [76,93,58], [77,94,59], [78,95,60], [79,96,61], [80,98,62], [82,99,64], [83,101,65], [84,101,66], [85,103,67], [87,105,68], [88,106,70], [89,107,70], [90,108,72], [91,109,72], [92,110,73], [93,112,75], [94,112,75], [95,113,76], [96,115,77], [97,116,78], [98,116,79], [99,118,80], [101,120,82], [102,121,83], [103,122,84], [104,123,84], [105,124,85], [106,125,87], [107,126,87], [108,127,88], [109,129,89], [110,130,90], [111,130,91], [112,131,92], [113,133,93], [114,134,94], [115,135,95], [116,136,95], [117,137,97], [118,138,98], [119,139,98], [120,140,99], [121,142,101], [122,142,101], [123,143,102], [124,144,103], [125,145,104], [126,147,105], [127,148,106], [129,150,108], [130,150,108], [131,152,110], [132,153,111], [133,154,112], [134,155,112], [135,156,113], [136,157,114], [137,159,116], [138,160,116], [139,161,117], [140,161,118], [141,162,119], [142,163,120], [143,165,121], [144,166,122], [145,167,123], [146,168,124], [147,169,125], [148,170,125], [149,171,126], [150,172,127], [151,174,129], [152,175,130], [153,176,130], [154,177,131], [155,178,132], [156,179,133], [157,180,134], [158,181,135], [159,182,136], [160,183,136], [161,183,137], [162,185,139], [163,186,140], [164,187,141], [165,188,142], [166,189,142], [167,190,143], [168,191,144], [169,192,145], [170,194,146], [171,195,147], [172,196,148], [173,197,149], [174,198,150], [175,199,150], [176,200,151], [177,201,152], [178,202,153], [179,203,154], [180,204,155], [181,205,156], [182,206,157], [183,207,158], [184,209,160], [185,210,161], [186,211,161], [187,212,162], [188,213,163], [189,214,164], [190,215,165], [191,217,166], [192,218,167], [194,219,168], [195,220,169], [196,221,170], [197,222,171], [198,223,172], [199,224,173], [200,225,174], [201,226,175], [202,227,176], [203,229,177], [204,230,178], [205,231,179], [206,232,180], [207,233,181], [208,234,182], [209,235,183], [210,236,183], [211,238,184], [212,239,185], [213,240,186], [214,241,187], [215,242,188], [217,243,189], [218,244,190], [219,246,191], [220,247,192], [221,248,194], [222,249,195], [223,250,196], [224,251,197], [225,253,198], [226,254,199], [227,255,200], [229,256,201], [230,257,202], [231,258,203], [232,260,204], [233,261,205], [234,262,206], [235,263,207], [236,264,208], [238,266,209], [239,267,210], [240,268,211], [241,269,212], [242,271,213], [243,272,214], [244,273,215], [246,274,217], [247,275,218], [248,277,219], [249,278,220], [250,279,221], [251,280,222], [253,282,223], [254,283,224], [255,284,225], [256,285,226], [257,287,227], [258,288,229], [260,289,230], [261,291,231], [262,292,232], [263,293,233], [264,294,234], [266,296,235], [267,297,236], [268,298,238], [269,300,239], [271,301,240], [272,302,241], [273,304,242], [274,305,243], [275,306,244], [277,307,246], [278,309,247], [279,310,248], [280,311,249], [282,313,250], [283,314,251], [284,315,253], [285,317,254], [287,318,255], [288,320,256], [289,321,257], [291,322,258], [292,324,260], [293,325,261], [294,326,262], [296,328,263], [297,329,264], [298,331,266], [300,332,267], [301,333,268], [302,335,269], [304,336,271], [305,337,272], [306,339,273], [307,340,274], [309,342,275], [310,343,277], [311,345,278], [313,346,279], [314,347,280], [315,349,282], [317,350,283], [318,352,284], [320,353,285], [321,355,287], [322,356,288], [324,358,289], [325,359,291], [326,360,292], [328,362,293], [329,363,294], [331,366,297], [332,366,297], [333,368,298], [335,369,300], [336,371,301], [337,372,302], [339,374,304], [340,375,305], [342,377,306], [343,378,307], [345,380,309], [346,381,310], [347,383,311], [349,384,313], [350,386,314], [352,388,315], [353,389,317], [355,391,318], [356,392,320], [358,394,321], [359,395,322], [360,397,324], [362,398,325], [363,400,326], [365,402,328], [366,403,329], [368,405,331], [369,406,332], [371,408,333], [372,410,335], [374,411,336], [375,413,337], [377,414,339], [378,416,340], [380,418,342], [381,419,343], [383,421,345], [384,422,346], [386,424,347], [388,426,349], [389,427,350], [391,429,352], [392,431,353], [394,432,355], [395,434,356], [397,436,358], [398,437,359], [400,439,360], [402,441,362], [403,442,363], [405,444,365], [406,446,366], [408,447,368], [410,449,369], [411,451,371], [413,453,372], [414,454,374], [416,456,375], [418,458,377], [419,460,378], [421,461,380], [422,463,381], [424,465,383], [426,466,384], [427,468,386], [429,470,388], [431,472,389], [432,474,391], [434,475,392], [436,477,394], [437,479,395], [439,481,397], [441,482,398], [442,484,400], [444,486,402], [446,488,403], [447,490,405], [449,492,406], [451,493,408], [453,495,410], [454,497,411], [456,499,413], [458,501,414], [460,503,416], [461,504,418], [463,506,419], [465,508,421], [466,510,422], [468,512,424], [470,514,426], [472,516,427], [474,518,429], [475,519,431], [477,521,432], [479,523,434], [481,525,436], [482,527,437], [484,529,439], [486,531,441], [488,533,442], [490,535,444], [492,537,446], [493,539,447], [495,541,449], [497,543,451], [499,545,453], [501,547,454], [503,548,456], [504,550,458], [506,552,460], [508,554,461], [510,556,463], [512,558,465], [514,560,466], [516,562,468], [518,564,470], [519,566,472], [521,569,474], [523,571,475], [525,573,477], [527,575,479], [529,577,481], [531,579,482], [533,581,484], [535,583,486], [537,585,488], [539,587,490], [541,589,492], [543,591,493], [545,593,495], [547,595,497], [548,597,499], [550,600,501], [552,602,503], [554,604,504], [556,606,506], [558,608,508], [560,610,510], [562,612,512], [564,615,514], [566,617,516], [569,619,518], [571,621,519], [573,623,521], [575,625,523], [577,628,525], [579,630,527], [581,632,529], [583,634,531], [585,636,533], [587,639,535], [589,641,537], [591,643,539], [593,645,541], [595,648,543], [597,650,545], [600,652,547], [602,654,548], [604,657,550], [606,659,552], [608,661,554], [610,663,556], [612,666,558], [615,668,560], [617,670,562], [619,673,564], [621,675,566], [623,677,569], [625,680,571], [628,682,573], [630,684,575], [632,687,577], [634,689,579], [636,691,581], [639,694,583], [641,696,585], [643,698,587], [645,701,589], [648,703,591], [650,706,593], [652,708,595], [654,710,597], [657,713,600], [659,715,602], [661,718,604], [663,720,606], [666,723,608], [668,725,610], [670,727,612], [673,730,615], [675,732,617], [677,735,619], [680,737,621], [682,740,623], [684,742,625], [687,745,628], [689,747,630], [691,750,632], [694,752,634], [696,755,636], [698,758,639], [701,760,641], [703,763,643], [706,765,645], [708,768,648], [710,770,650], [713,773,652], [715,775,654], [718,778,657], [720,781,659], [723,783,661], [725,786,663], [727,789,666], [730,791,668], [732,794,670], [735,796,673], [737,799,675], [740,802,677], [742,804,680], [745,807,682], [747,810,684], [750,812,687], [752,815,689], [755,818,691], [758,821,694], [760,823,696], [763,826,698], [765,829,701], [768,831,703], [770,834,706], [773,837,708], [775,840,710], [778,843,713], [781,845,715], [783,848,718], [786,851,720], [789,854,723], [791,856,725], [794,859,727], [796,862,730], [799,865,732], [802,868,735], [804,871,737], [807,873,740], [810,876,742], [812,879,745], [815,882,747], [818,885,750], [821,888,752], [823,891,755], [826,894,758], [829,897,760], [831,899,763], [834,902,765], [837,905,768], [840,908,770], [843,914,775], [845,914,775], [848,917,778], [851,920,781], [854,923,783], [856,926,786], [859,929,789], [862,932,791], [865,935,794], [868,938,796], [871,941,799], [873,944,802], [876,947,804], [879,950,807], [882,953,810], [885,957,812], [888,960,815], [891,963,818], [894,966,821], [897,969,823], [899,972,826], [902,975,829], [905,978,831], [908,981,834], [911,985,837], [914,988,840], [917,991,843], [920,994,845], [923,997,848], [926,1001,851], [929,1004,854], [932,1007,856], [935,1010,859], [938,1013,862], [941,1017,865], [944,1020,868], [947,1023,871], [950,1026,873], [953,1030,876], [957,1033,879], [960,1036,882], [963,1040,885], [966,1043,888], [969,1046,891], [972,1050,894], [975,1053,897], [978,1056,899], [981,1060,902], [985,1063,905], [988,1066,908], [991,1070,911], [994,1073,914], [997,1076,917], [1001,1080,920], [1004,1083,923], [1007,1087,926], [1010,1090,929], [1013,1094,932], [1017,1097,935], [1020,1101,938], [1023,1104,941], [1026,1107,944], [1030,1111,947], [1033,1114,950], [1036,1118,953], [1040,1122,957], [1043,1125,960], [1046,1129,963], [1050,1132,966], [1053,1136,969], [1056,1139,972], [1060,1143,975], [1063,1146,978], [1066,1150,981], [1070,1154,985], [1073,1157,988], [1076,1161,991], [1080,1165,994], [1083,1168,997], [1087,1172,1001], [1090,1176,1004], [1094,1179,1007], [1097,1183,1010], [1101,1187,1013], [1104,1190,1017], [1107,1194,1020], [1111,1198,1023], [1114,1202,1026], [1118,1205,1030], [1122,1209,1033], [1125,1213,1036], [1129,1217,1040], [1132,1220,1043], [1136,1224,1046], [1139,1228,1050], [1143,1232,1053], [1146,1236,1056], [1150,1239,1060], [1154,1243,1063], [1157,1247,1066], [1161,1251,1070], [1165,1255,1073], [1168,1259,1076], [1172,1263,1080], [1176,1267,1083], [1179,1267,1087], [1183,1267,1090], [1187,1267,1094], [1190,1267,1097], [1194,1267,1101], [1198,1267,1104], [1202,1267,1107], [1205,1267,1111], [1209,1267,1114], [1213,1267,1118], [1217,1267,1122], [1220,1267,1125], [1224,1267,1129], [1228,1267,1132], [1232,1267,1136], [1236,1267,1139], [1239,1267,1143], [1243,1267,1146], [1247,1267,1150], [1251,1267,1154], [1255,1267,1157], [1259,1267,1161], [1263,1267,1165], [1267,1267,1168]];
    TRUE_TO_SLIDER:   TRSZ2SArray      = [[0,0], [1,0], [2,0], [3,1], [4,1], [5,1], [6,1], [7,1], [8,2], [9,2], [10,2], [11,2], [12,3], [13,3], [14,3], [15,3], [16,4], [17,4], [18,4], [19,4], [20,5], [21,5], [22,5], [23,5], [24,5], [25,6], [26,6], [27,6], [28,6], [29,7], [30,7], [31,7], [32,7], [33,7], [34,8], [35,8], [36,8], [37,8], [38,9], [39,9], [40,9], [41,9], [42,9], [43,10], [44,10], [45,10], [46,10], [47,10], [48,11], [49,11], [50,11], [51,11], [52,11], [53,11], [54,12], [55,12], [56,12], [57,12], [58,14], [59,14], [60,14], [61,14], [62,14], [63,14], [64,15], [65,15], [66,15], [67,15], [68,15], [69,16], [70,16], [71,16], [72,16], [73,16], [74,16], [75,17], [76,17], [77,17], [78,17], [79,17], [80,18], [81,18], [82,18], [83,18], [84,18], [85,18], [86,19], [87,19], [88,19], [89,19], [90,19], [91,19], [92,20], [93,20], [94,20], [95,20], [96,20], [97,20], [98,21], [99,21], [100,21], [101,21], [102,21], [103,21], [104,22], [105,22], [106,22], [107,22], [108,22], [109,22], [110,23], [111,23], [112,23], [113,23], [114,23], [115,23], [116,24], [117,24], [118,24], [119,24], [120,24], [121,24], [122,24], [123,25], [124,25], [125,25], [126,25], [127,25], [128,25], [129,25], [130,26], [131,26], [132,26], [133,26], [134,26], [135,26], [136,26], [137,27], [138,27], [139,27], [140,27], [141,27], [142,27], [143,28], [144,28], [145,28], [146,28], [147,28], [148,28], [149,28], [150,29], [151,29], [152,29], [153,29], [154,29], [155,29], [156,29], [157,29], [158,30], [159,30], [160,30], [161,30], [162,30], [163,30], [164,30], [165,31], [166,31], [167,31], [168,31], [169,31], [170,31], [171,31], [172,31], [173,32], [174,32], [175,32], [176,32], [177,32], [178,32], [179,32], [180,32], [181,33], [182,33], [183,33], [184,33], [185,33], [186,33], [187,33], [188,34], [189,34], [190,34], [191,34], [192,34], [193,34], [194,34], [195,34], [196,34], [197,35], [198,35], [199,35], [200,35], [201,35], [202,35], [203,35], [204,35], [205,36], [206,36], [207,36], [208,36], [209,36], [210,36], [211,36], [212,36], [213,38], [214,38], [215,38], [216,38], [217,38], [218,38], [219,38], [220,38], [221,38], [222,39], [223,39], [224,39], [225,39], [226,39], [227,39], [228,39], [229,39], [230,39], [231,40], [232,40], [233,40], [234,40], [235,40], [236,40], [237,40], [238,40], [239,40], [240,41], [241,41], [242,41], [243,41], [244,41], [245,41], [246,41], [247,41], [248,41], [249,42], [250,42], [251,42], [252,42], [253,42], [254,42], [255,42], [256,42], [257,42], [258,43], [259,43], [260,43], [261,43], [262,43], [263,43], [264,43], [265,43], [266,43], [267,43], [268,44], [269,44], [270,44], [271,44], [272,44], [273,44], [274,44], [275,44], [276,44], [277,44], [278,45], [279,45], [280,45], [281,45], [282,45], [283,45], [284,45], [285,45], [286,45], [287,45], [288,46], [289,46], [290,46], [291,46], [292,46], [293,46], [294,46], [295,46], [296,46], [297,46], [298,47], [299,47], [300,47], [301,47], [302,47], [303,47], [304,47], [305,47], [306,47], [307,47], [308,48], [309,48], [310,48], [311,48], [312,48], [313,48], [314,48], [315,48], [316,48], [317,48], [318,48], [320,49], [321,49], [322,49], [323,49], [324,49], [325,49], [326,49], [327,49], [328,49], [329,49], [331,50], [332,50], [333,50], [334,50], [335,50], [336,50], [337,50], [338,50], [339,50], [340,50], [342,51], [343,51], [344,51], [345,51], [346,51], [347,51], [348,51], [349,51], [350,51], [351,51], [352,51], [353,52], [354,52], [355,52], [356,52], [357,52], [358,52], [359,52], [360,52], [361,52], [362,52], [363,52], [365,53], [366,53], [367,53], [368,53], [369,53], [370,53], [371,53], [372,53], [373,53], [374,53], [375,53], [377,54], [378,54], [379,54], [380,54], [381,54], [382,54], [383,54], [384,54], [385,54], [386,54], [387,54], [388,54], [389,55], [390,55], [391,55], [392,55], [393,55], [394,55], [395,55], [396,55], [397,55], [398,55], [399,55], [400,55], [402,56], [403,56], [404,56], [405,56], [406,56], [407,56], [408,56], [409,56], [410,56], [411,56], [412,56], [413,56], [414,57], [415,57], [416,57], [417,57], [418,57], [419,57], [420,57], [421,57], [422,57], [423,57], [424,57], [425,57], [426,57], [427,58], [428,58], [429,58], [430,58], [431,58], [432,58], [433,58], [434,58], [435,58], [436,58], [437,58], [438,58], [439,58], [441,59], [442,59], [443,59], [444,59], [445,59], [446,59], [447,59], [448,59], [449,59], [450,59], [451,59], [452,59], [453,59], [454,60], [455,60], [456,60], [457,60], [458,60], [459,60], [460,60], [461,60], [462,60], [463,60], [464,60], [465,60], [466,60], [468,61], [469,61], [470,61], [471,61], [472,61], [473,61], [474,61], [475,61], [476,61], [477,61], [478,61], [479,61], [480,61], [481,61], [482,62], [483,62], [484,62], [485,62], [486,62], [487,62], [488,62], [489,62], [490,62], [491,62], [492,62], [493,62], [494,62], [495,62], [497,64], [498,64], [499,64], [500,64], [501,64], [502,64], [503,64], [504,64], [505,64], [506,64], [507,64], [508,64], [509,64], [510,64], [512,65], [513,65], [514,65], [515,65], [516,65], [517,65], [518,65], [519,65], [520,65], [521,65], [522,65], [523,65], [524,65], [525,65], [527,66], [528,66], [529,66], [530,66], [531,66], [532,66], [533,66], [534,66], [535,66], [536,66], [537,66], [538,66], [539,66], [540,66], [541,66], [543,67], [544,67], [545,67], [546,67], [547,67], [548,67], [549,67], [550,67], [551,67], [552,67], [553,67], [554,67], [555,67], [556,67], [558,68], [559,68], [560,68], [561,68], [562,68], [563,68], [564,68], [565,68], [566,68], [567,68], [568,68], [569,68], [570,68], [571,68], [572,68], [573,68], [575,69], [576,69], [577,69], [578,69], [579,69], [580,69], [581,69], [582,69], [583,69], [584,69], [585,69], [586,69], [587,69], [588,69], [589,69], [591,70], [592,70], [593,70], [594,70], [595,70], [596,70], [597,70], [598,70], [599,70], [600,70], [601,70], [602,70], [603,70], [604,70], [605,70], [606,70], [608,71], [609,71], [610,71], [611,71], [612,71], [613,71], [614,71], [615,71], [616,71], [617,71], [618,71], [619,71], [620,71], [621,71], [622,71], [623,71], [625,72], [626,72], [627,72], [628,72], [629,72], [630,72], [631,72], [632,72], [633,72], [634,72], [635,72], [636,72], [637,72], [638,72], [639,72], [640,72], [641,72], [643,73], [644,73], [645,73], [646,73], [647,73], [648,73], [649,73], [650,73], [651,73], [652,73], [653,73], [654,73], [655,73], [656,73], [657,73], [658,73], [659,73], [661,74], [662,74], [663,74], [664,74], [665,74], [666,74], [667,74], [668,74], [669,74], [670,74], [671,74], [672,74], [673,74], [674,74], [675,74], [676,74], [677,74], [680,75], [681,75], [682,75], [683,75], [684,75], [685,75], [686,75], [687,75], [688,75], [689,75], [690,75], [691,75], [692,75], [693,75], [694,75], [695,75], [696,75], [698,76], [699,76], [700,76], [701,76], [702,76], [703,76], [704,76], [705,76], [706,76], [707,76], [708,76], [709,76], [710,76], [711,76], [712,76], [713,76], [714,76], [715,76], [718,77], [719,77], [720,77], [721,77], [722,77], [723,77], [724,77], [725,77], [726,77], [727,77], [728,77], [729,77], [730,77], [731,77], [732,77], [733,77], [734,77], [735,77], [737,78], [738,78], [739,78], [740,78], [741,78], [742,78], [743,78], [744,78], [745,78], [746,78], [747,78], [748,78], [749,78], [750,78], [751,78], [752,78], [753,78], [754,78], [755,78], [758,79], [759,79], [760,79], [761,79], [762,79], [763,79], [764,79], [765,79], [766,79], [767,79], [768,79], [769,79], [770,79], [771,79], [772,79], [773,79], [774,79], [775,79], [778,80], [779,80], [780,80], [781,80], [782,80], [783,80], [784,80], [785,80], [786,80], [787,80], [788,80], [789,80], [790,80], [791,80], [792,80], [793,80], [794,80], [795,80], [796,80], [799,81], [800,81], [801,81], [802,81], [803,81], [804,81], [805,81], [806,81], [807,81], [808,81], [809,81], [810,81], [811,81], [812,81], [813,81], [814,81], [815,81], [816,81], [817,81], [818,81], [821,82], [822,82], [823,82], [824,82], [825,82], [826,82], [827,82], [828,82], [829,82], [830,82], [831,82], [832,82], [833,82], [834,82], [835,82], [836,82], [837,82], [838,82], [839,82], [840,82], [843,83], [844,83], [845,83], [846,83], [847,83], [848,83], [849,83], [850,83], [851,83], [852,83], [853,83], [854,83], [855,83], [856,83], [857,83], [858,83], [859,83], [860,83], [861,83], [862,83], [865,84], [866,84], [867,84], [868,84], [869,84], [870,84], [871,84], [872,84], [873,84], [874,84], [875,84], [876,84], [877,84], [878,84], [879,84], [880,84], [881,84], [882,84], [883,84], [884,84], [885,84], [888,85], [889,85], [890,85], [891,85], [892,85], [893,85], [894,85], [895,85], [896,85], [897,85], [898,85], [899,85], [900,85], [901,85], [902,85], [903,85], [904,85], [905,85], [906,85], [907,85], [908,85], [911,86], [912,86], [913,86], [914,86], [915,86], [916,86], [917,86], [918,86], [919,86], [920,86], [921,86], [922,86], [923,86], [924,86], [925,86], [926,86], [927,86], [928,86], [929,86], [930,86], [931,86], [932,86], [935,88], [936,88], [937,88], [938,88], [939,88], [940,88], [941,88], [942,88], [943,88], [944,88], [945,88], [946,88], [947,88], [948,88], [949,88], [950,88], [951,88], [952,88], [953,88], [954,88], [955,88], [956,88], [957,88], [960,89], [961,89], [962,89], [963,89], [964,89], [965,89], [966,89], [967,89], [968,89], [969,89], [970,89], [971,89], [972,89], [973,89], [974,89], [975,89], [976,89], [977,89], [978,89], [979,89], [980,89], [981,89], [985,90], [986,90], [987,90], [988,90], [989,90], [990,90], [991,90], [992,90], [993,90], [994,90], [995,90], [996,90], [997,90], [998,90], [999,90], [1000,90], [1001,90], [1002,90], [1003,90], [1004,90], [1005,90], [1006,90], [1007,90], [1010,91], [1011,91], [1012,91], [1013,91], [1014,91], [1015,91], [1016,91], [1017,91], [1018,91], [1019,91], [1020,91], [1021,91], [1022,91], [1023,91], [1024,91], [1025,91], [1026,91], [1027,91], [1028,91], [1029,91], [1030,91], [1031,91], [1032,91], [1033,91], [1036,92], [1037,92], [1038,92], [1039,92], [1040,92], [1041,92], [1042,92], [1043,92], [1044,92], [1045,92], [1046,92], [1047,92], [1048,92], [1049,92], [1050,92], [1051,92], [1052,92], [1053,92], [1054,92], [1055,92], [1056,92], [1057,92], [1058,92], [1059,92], [1060,92], [1063,93], [1064,93], [1065,93], [1066,93], [1067,93], [1068,93], [1069,93], [1070,93], [1071,93], [1072,93], [1073,93], [1074,93], [1075,93], [1076,93], [1077,93], [1078,93], [1079,93], [1080,93], [1081,93], [1082,93], [1083,93], [1084,93], [1085,93], [1086,93], [1087,93], [1090,94], [1091,94], [1092,94], [1093,94], [1094,94], [1095,94], [1096,94], [1097,94], [1098,94], [1099,94], [1100,94], [1101,94], [1102,94], [1103,94], [1104,94], [1105,94], [1106,94], [1107,94], [1108,94], [1109,94], [1110,94], [1111,94], [1112,94], [1113,94], [1114,94], [1118,95], [1119,95], [1120,95], [1121,95], [1122,95], [1123,95], [1124,95], [1125,95], [1126,95], [1127,95], [1128,95], [1129,95], [1130,95], [1131,95], [1132,95], [1133,95], [1134,95], [1135,95], [1136,95], [1137,95], [1138,95], [1139,95], [1140,95], [1141,95], [1142,95], [1143,95], [1146,96], [1147,96], [1148,96], [1149,96], [1150,96], [1151,96], [1152,96], [1153,96], [1154,96], [1155,96], [1156,96], [1157,96], [1158,96], [1159,96], [1160,96], [1161,96], [1162,96], [1163,96], [1164,96], [1165,96], [1166,96], [1167,96], [1168,96], [1169,96], [1170,96], [1171,96], [1172,96], [1176,97], [1177,97], [1178,97], [1179,97], [1180,97], [1181,97], [1182,97], [1183,97], [1184,97], [1185,97], [1186,97], [1187,97], [1188,97], [1189,97], [1190,97], [1191,97], [1192,97], [1193,97], [1194,97], [1195,97], [1196,97], [1197,97], [1198,97], [1199,97], [1200,97], [1201,97], [1202,97], [1205,98], [1206,98], [1207,98], [1208,98], [1209,98], [1210,98], [1211,98], [1212,98], [1213,98], [1214,98], [1215,98], [1216,98], [1217,98], [1218,98], [1219,98], [1220,98], [1221,98], [1222,98], [1223,98], [1224,98], [1225,98], [1226,98], [1227,98], [1228,98], [1229,98], [1230,98], [1231,98], [1232,98], [1236,99], [1237,99], [1238,99], [1239,99], [1240,99], [1241,99], [1242,99], [1243,99], [1244,99], [1245,99], [1246,99], [1247,99], [1248,99], [1249,99], [1250,99], [1251,99], [1252,99], [1253,99], [1254,99], [1255,99], [1256,99], [1257,99], [1258,99], [1259,99], [1260,99], [1261,99], [1262,99], [1263,99], [1267,100]];
  end;


function TRSZoomStepArray.GetNext(value: Int32; down: Boolean): Int32;
var
  i: Int32;
begin
  for i := 0 to High(Self) do
    if value = Self[i].Level then
    begin
      if down then
        Exit(Self[i].Down)
      else
        Exit(Self[i].Up);
    end;
end;

function TRSZoomStepArray.GetNext(value: Int32; amount: Int32 = 1; down: Boolean = True): Int32; overload;
var
  i: Int32;
begin
  Result := value;
  for i := 0 to amount-1 do
    Result := Self.GetNext(Result, down);
end;


function TRSMouseZoom.GetSlider(value: Int32 = -1): Int32;
var
  i: Int32;
begin
  Result := -1;

  if value < 0 then
    value := Self.TrueZoomLevel;

  for i := 0 to High(Self.TRUE_TO_SLIDER) do
    if value = Self.TRUE_TO_SLIDER[i].TrueZoom then
      Exit(Self.TRUE_TO_SLIDER[i].Slider);

  TerminateScript('Missing zoom level: [' + ToString(value) + ',' + ToString(Options.GetZoomLevel()) + '], Please give this message to Torwent.');
end;

procedure TRSMouseZoom.Scroll(amount: Int32 = 1; down: Boolean = True; moveMouse: Boolean = False);
begin
  Self.TrueZoomLevel := TRSMouseZoom.TRUE_ZOOM_LEVELS.GetNext(Self.TrueZoomLevel, amount, down);

  MM2MS.ZoomLevel := Self.GetSlider(Self.TrueZoomLevel);

  if moveMouse then
    Mouse.Scroll(MainScreen.Bounds(), amount, down)
  else
    Mouse.Scroll(amount, down);
end;

procedure TRSMouseZoom.AntiLogout(i, iterations: Int32);
begin
  if Frac(i/1000) = 0 then
    WriteLn('Progress: ', i, ' of ', iterations);

  if Frac(i/250) <> 0 then
    Exit;

  if Frac(i/500) = 0 then
    Options.SetZoomLevel(50)
  else
    case SRL.Dice(50) of
      True:  Minimap.SetCompassAngle(Minimap.GetCompassAngle() - RandomMode(30, 360, 3));
      False: Minimap.SetCompassAngle(Minimap.GetCompassAngle() + RandomMode(30, 360, 3));
    end;

  Mouse.Move(MainScreen.Bounds(), True);
end;


procedure TRSMouseZoom.RunStressTest(iterations: Int32 = 19999);
var
  i, slider: Int32;
  fails: TIntegerArray;
  down: Boolean;
begin
  Options.SetZoomLevel(50);
  Mouse.Move(MainScreen.Bounds(), True);

  SetLength(fails, 5);

  for i := 0 to iterations do
  begin
    Self.AntiLogout(i, iterations);
    Down := SRL.Dice(48);

    Self.Scroll(1, down, True);
    Wait(5);
    slider := Options.GetZoomLevel();

    if slider = MM2MS.ZoomLevel then
      Continue;

    fails[0] += 1;
    if InRange(MM2MS.ZoomLevel, slider-2, slider+2) then
      Continue;

    fails[1] += 1
    if InRange(MM2MS.ZoomLevel, slider-5, slider+5) then
      Continue;

    fails[2] += 1;
    if InRange(MM2MS.ZoomLevel, slider-10, slider+10) then
      Continue;

    fails[3] += 1;
    if InRange(MM2MS.ZoomLevel, slider-15, slider+15) then
      Continue;

    fails[4] += 1;
  end;

  WriteLn 'Level 0 fail = any fail.'+ LINEENDING + 'Level 1 fail = Fail that was off by 2' + LINEENDING +
          'Level 2 fail = Fail that was off by 5' + LINEENDING +
          'Level 3 fail = Fail that was off by 10 (this can really break things)' + LINEENDING +
          'Level 4 fail = Fail that was off by 15 (this can really break things)';

  for i := 0 to High(fails) do
    WriteLn('Level ', i, ' fail rate: ', fails[i], '/', iterations, ' (', Round(fails[i]/iterations * 100, 2), '%)');
end;


procedure TRSMouseZoom.DrawGraph();
var
  bmp: TMufasaBitmap;
begin
  bmp := TMufasaBitmap.Create(1300, 1300);
  (*
  bmp.DrawTPA(TPointArray(Self.TRUE_ZOOM_IN), $00FFFF);
  bmp.DrawTPA(TPointArray(Self.TRUE_ZOOM_OUT), $FF00FF);
  bmp.DrawTPA(TPointArray(Self.TRUE_TO_SLIDER), $FFFFFF);
  *)
  bmp.Show(True);
  bmp.Free();
end;

var
  RSMouseZoom: TRSMouseZoom;

function TRSOptions.SetZoomLevel(Level: Int32): Boolean; override;
begin
  Result := inherited();
  if not Result then
    Exit;

  case Level of
    0:   RSMouseZoom.TrueZoomLevel := 0;
    25:  RSMouseZoom.TrueZoomLevel := 123;
    50:  RSMouseZoom.TrueZoomLevel := 331;
    75:  RSMouseZoom.TrueZoomLevel := 680;
    100: RSMouseZoom.TrueZoomLevel := 1268;
  end;
end;

